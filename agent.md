# AGENTS.md

## 0. 本文件的强制性说明（IMPORTANT）

本项目由**人类开发者主导**，AI（包括 Codex）仅作为辅助分析与实现工具使用。  
**任何 AI 行为必须严格遵守本文件约定，否则应主动中止并请求人工确认。**

本文件仅用于：
- 约束 AI 的行为边界
- 明确 AI 的阅读顺序与决策权限
- 防止需求、流程、数据库结构发生偏移

本文件 **不用于** 描述业务需求、用户流程或数据库设计细节。

---

## 1. 必须读取的基准文件（强制顺序）

在执行任何分析、设计建议、代码修改或文档输出前，AI **必须**按以下顺序完成阅读：

1. `agent.md`（本文件）
   - 定义 AI 行为边界与硬性约束
2. `DOC_INDEX.md`
      - 项目文档索引与职责说明
      - 用于理解各类文档的定位、主次关系与使用场景
3. `project_spec.md`
   - **唯一的业务需求、流程与规则说明文件**
   - 定义：项目做什么、不做什么、流程如何走、必须遵守的业务规则
4. `db_schema.md`
   - **数据库结构主参考文件（冻结）**
   - 仅用于表与字段速查，不包含业务流程
5. `PROJECT_CHANGELOG.md`
   - 项目当前状态与历史记录的唯一事实来源（Single Source of Truth）

> 若上述任一文件缺失、内容不完整或存在冲突，  
> AI 必须先指出问题并请求人工确认，不得自行假设或补全。

---

## 2. 项目定位与不可突破边界（硬性约束）

### 2.1 项目性质
- 本项目为 **本科毕业设计**
- 核心目标：
  - 功能完整
  - 流程清晰
  - 原理可解释、可答辩
- **不追求**：
  - 工业级性能
  - 高并发、高可用架构
  - 复杂工程化或过度设计

### 2.2 技术与实现边界
- 技术选型、功能范围以 `project_spec.md` 为唯一依据
- 禁止未经明确许可引入：
  - 微服务架构
  - Redis / MQ / Elasticsearch 等中间件
  - 深度学习模型或复杂推荐框架
- 推荐算法实现：
  - 以 KNN 等经典方法为主
  - 教学级、示例级即可

> 若 AI 判断需要突破上述边界，  
> **必须先说明理由并等待人工确认**。

---

## 3. 数据库结构冻结规则（强制）

- `db_schema.md` 中描述的数据库结构为 **最终确认版本**
- AI **不得**：
  - 新增或删除表
  - 新增或删除字段
  - 修改字段语义或约束含义
- 所有业务规则、排他逻辑、状态流转与一致性问题：
  - **必须通过业务层（Service / Transaction）实现**
  - 不得通过修改数据库结构解决

### 补充说明
- `新数据库表结构_v3.md` 为 **历史完整版对照与设计留档**
- 除非人工明确要求复核，否则 **不得作为主参考文件**

---

## 4. AI 的角色与权限边界

### 4.1 AI 允许做的事情
- 阅读与分析现有代码与文档
- 提出实现建议、风险提示或简化方案
- 按要求生成代码、说明文档、示例
- 给出 commit message 的**命名建议**
- 给出 `PROJECT_CHANGELOG.md` 的填写草稿

### 4.2 AI 禁止做的事情
- 擅自扩大项目范围或复杂度
- 假设用户具备高阶工程能力
- 跳过文档直接给出“最终方案”
- 擅自修改冻结的数据库结构
- 自动执行以下行为：
  - `git commit`
  - `git push`
  - 修改 `PROJECT_CHANGELOG.md` 的最终内容

---

## 5. 标准输出格式（强制）

凡涉及以下任一行为：
- 功能实现
- 代码修改
- 架构 / 设计建议
- 阶段性总结

AI 输出 **必须至少包含**：

1. 上下文对齐确认  
2. 本次变更目标说明  
3. 变更内容摘要  
4. 验证方式说明  
5. Commit 命名建议（不执行提交）  
6. CHANGELOG 更新草稿  
7. 偏移自检（是否违反本文件约束）

> 若信息不足，应在“上下文对齐确认”阶段直接中止并请求补充。

---

## 6. 开发过程追踪规则

### 6.1 状态事实来源
- `PROJECT_CHANGELOG.md` 是 **唯一权威状态来源**
- AI 不得仅凭代码结构推断项目完成度

### 6.2 一次 AI 参与的最小闭环
一次有效的 AI 参与，应形成以下闭环之一：
- 建议 → 人工确认 → 实现 → commit → changelog 草稿  
- 分析 → 设计说明 → 风险提示 → 待办记录

---

## 7. 偏移自检（AI 自检义务）

在每次输出的最后，AI **必须**进行以下自检：

- 是否偏离项目定位（本科毕设）
- 是否引入未声明的技术或目标
- 是否增加了不必要的复杂度
- 是否试图修改冻结的数据库结构
- 是否引用了非主参考文件作为依据

若任一项为“是”，必须明确标注并说明原因。

---

## 8. 冲突处理优先级（由高到低）

1. 人类开发者的当前明确指令  
2. `agent.md`（本文件）  
3. `project_spec.md`  
4. `db_schema.md`  
5. `PROJECT_CHANGELOG.md`  
6. 既有代码实现  
7. AI 的默认最佳实践  

---

## 9. 最终原则

> **文件结构稳定优先于实现速度  
> 规则清晰优先于功能堆叠  
> 可答辩性优先于“看起来很高级”**

AI 的所有输出，都应服务于上述原则。