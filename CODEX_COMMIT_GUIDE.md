# Codex + Git 提交规范说明（main-only 工作流 · 人工确认版）

> 适用对象：使用 Codex / VS Code 进行代码修改的个人项目  
> 使用目标：**Codex 只负责改代码和“给出建议的 commit 命名”，  
> 提交（commit）必须由人工确认并手动完成**

---

## 一、使用原则（非常重要）

### ✅ 人机分工明确

- **Codex 的职责**
  - 修改 / 新增 / 重构代码
  - 在修改完成后：
    - 参阅提交规范文件
    - **给出一个或多个“建议的 commit message”**
  - ❌ **不得自行执行 `git commit` 或 `git push`**

- **人工（你）的职责**
  - 运行项目，确认是否“能跑”
  - 审阅 Codex 给出的 commit 命名是否准确
  - **由你本人手动填写 commit message 并提交**

> ⚠️ 本项目中：  
> **任何 commit 都必须经过人工确认**  
> Codex 仅提供“命名建议”，不直接写入 Git 历史

---

## 二、提交消息模板说明（Codex 必须参阅）

### 实际生效的模板文件
```
.commit-template.txt
```

### 模板内容（供 Codex 理解）
```text
<type>: <简要说明> [OK]

# 说明（不会进入提交历史）：
# - 功能/改动点：
# - 影响的页面 / 接口：
# - 验证方式（如何确认能跑）：
# - 备注（可选）：
```

### 使用约束
- Codex **只需根据该模板给出第一行的命名建议**
- 不需要填写 `#` 说明部分
- 所有建议的可回滚版本必须使用 `[OK]`

---

## 三、commit 命名规范（用于 Codex 生成“建议命名”）

### 1️⃣ type 类型（只能从下列选择）

| 类型 | 使用场景 |
|----|----|
| `feat` | 新增功能 / 页面 / 接口 |
| `fix` | 修复 bug / 启动失败 / 运行错误 |
| `docs` | 文档、说明、记录 |
| `chore` | 配置、清理、非功能性修改 |
| `refactor` | 重构（不改变功能） |

---

### 2️⃣ 状态标记说明

| 状态 | 含义 |
|----|----|
| `[OK]` | 功能完成，项目可以正常运行 |
| `[WIP]` | 未完成（仅作为建议，不应提交） |
| `[BROKEN]` | 已知错误版本（仅用于说明，不应提交） |

> ⚠️ 实际提交时，**只允许使用 `[OK]`**

---

## 四、Codex 输出要求（关键）

当 Codex 完成代码修改后，**必须以如下结构输出结果**：

### ✅ 必须包含
1. **修改内容摘要**（做了什么）
2. **验证建议**（如何确认能跑）
3. **1–3 条建议的 commit message（仅第一行）**

### 示例输出格式（示意）

```text
修改摘要：
- 新增 /yes 页面
- 添加对应 Controller 与路由

验证方式：
- 启动项目
- 访问 http://localhost:8080/yes 返回 "yes"

建议的 commit message：
1. feat: 新增 /yes 页面 [OK]
```

---

## 五、人工提交流程（你真正要做的事）

### 固定流程（不要跳过）

```text
1. 查看 Codex 修改结果
2. 本地运行项目，确认功能正常
3. 审阅 Codex 给出的 commit 命名建议
4. 如有需要，手动微调命名文本
5. 由人工执行 git commit
6. git push
```

> Codex **不参与第 5、6 步**

---

## 六、常见注意事项

- ❌ 不允许 Codex 自动提交
- ❌ 不允许自动 push
- ❌ 不允许生成模糊 commit 名称（如“更新代码”）

- ✅ commit 名称必须具体、可验证
- ✅ 一次 commit 只做一件主要事情

---

## 七、一句话原则（请牢记）

> **Codex 给建议，人来拍板；  
> 提交在我，责任在我。**

---

📎 文件名：`CODEX_COMMIT_GUIDE.md`  
📌 建议位置：项目根目录（与 `.commit-template.txt` 同级）
